### MySQL数据模型

<!-- TOC -->
    * [MySQL数据模型](#mysql数据模型)
    * [SQL](#sql)
    * [通用语法](#通用语法)
    * [SQL 分类](#sql-分类)
    * [DDL](#ddl)
      * [操作数据库](#操作数据库)
      * [操作表](#操作表)
    * [DML](#dml)
      * [操作数据](#操作数据)
    * [DQL](#dql)
      * [查询语法](#查询语法)
      * [基础查询](#基础查询)
      * [条件查询 (WHERE)](#条件查询-where)
      * [排序查询 (ORDER BY)](#排序查询-order-by)
      * [分组查询 (GROUP BY)](#分组查询-group-by)
      * [分页查询 (LIMIT)](#分页查询-limit)
<!-- TOC -->

**关系型数据库**

关系型数据库是建立在关系模型基础上的数据库，简单来说，关系型数据库是由多张能互相连接的二维表组成的数据库。

**优点**

1. 都是使用表结构，格式一致，易于维护；
2. 使用通用的SQL语言操作，使用方便，可用于复杂查询；
3. 数据存储在磁盘中，安全；

### SQL

Structured Query Language, 简称SQL，是用于操作关系型数据库的语言，定义操作所有关系型数据库的统一标准。对于同一个需求，不同数据库操作的方式可能会不一致，我们称之为 方言


### 通用语法

1. SQL 语句可以单行或者多行书写，以分号结尾；
2. MySQL 数据库的 SQL 语句不区分大小写，但是建议关键字使用大写；
3. 注释

### SQL 分类

- DDL: Data Definition Language，数据定义语言，用于定义数据库对象，如数据库，表，列等；
- DML: Data Manipulation Language，数据操作语言，用于对数据库中表的数据进行增删改查等操作；
- DQL: Data Query Language, 数据查询语言，用于查询数据库中表的记录；
- DCL: Data Control Language, 数据控制语言，用于定义数据库的访问权限和安全级别，以及创建用户；


### DDL

#### 操作数据库

1. 创建数据库

```sql
-- CREATE DATABASE 数据库名称
-- 判断，如果不存在该数据库，则进行创建
CREATE DATABASE IF NOT EXISTS db_java_web;
```

2. 删除数据库

```sql
-- DROP DATABASE 数据库名称
-- 判断，如果存在该数据库，则进行删除
DROP DATABASE IF EXISTS db_java_web;
```

3. 查询数据库

```sql
SHOW DATABASES;
```

#### 操作表

1. 查询表

```sql
SHOW TABLES;
```

2. 创建表

```sql
CREATE TABLE 表名 (
	字段名1 数据类型1,
	字段名2 数据类型2,
	...
);


CREATE TABLE tb_user (
	id int,
	username varchar(20),
	password(32)
)
```

3. 删除表

```sql
DROP TABLE IF EXISTS tb_user;
```

4. 修改表

```sql
-- 1. 修改表名
ALTER TABLE 表名 RENAME TO 新的表名;

-- 2. 新增列
ALTER TABLE 表名 ADD 列名 数据类型;

-- 3. 修改列数据类型
ALTER TABLE 表名 MODIFY 列名 数据类型;

-- 4. 修改列名和数据类型
ALTER TABLE 表名 CHANGE 列名 新列名 数据类型;

-- 5. 删除列
ALTER TABLE 表名 DROP 列名;
```


### DML

#### 操作数据

1. 添加数据

```sql
-- 1. 给指定列添加数据
INSERT INTO 表名(列名1, 列名2, ...) VALUES (值1, 值2, ...);

-- 2. 给全部列添加数据
INSERT INTO 表名 VALUES (值1, 值2, ...);

-- 3. 批量添加数据
INSERT INTO 表名(列名1, 列名2, ...) VALUES (值1, 值2, ...), (值1, 值2, ...);
INSERT INTO 表名 VALUES (值1, 值2, ...), (值1, 值2, ...);
```


2. 修改数据

```sql
UPDATE 表名 SET 列名1 = 值1, 列名2 = 值2, ... [WHERE 条件]; 
```

3. 删除数据

```sql
DELETE FROM 表名 [WHERE 条件]
```

注意：修改和删除数据时，如果不加条件，则将会操作所有的数据。


### DQL

#### 查询语法

```sql
SELECT 
	字段列表
FROM
	表名列表
WHERE
	条件列表
GROUP BY
	分组字段
HAVING
	分组后条件
ORDER BY
	排序字段
LIMIT
	分页限定
```


#### 基础查询

```sql
-- 查询 name, age
SELECT `NAME`, age FROM stu;

-- 查询所有的列
SELECT * FROM stu;

-- 去除重复的数据
SELECT DISTINCT address FROM stu;
```


#### 条件查询 (WHERE)

```sql
-- 1. 查询年龄大于20岁的学生信息
SELECT * FROM stu WHERE age > 20;

-- 2. 查询年龄大于等于20岁的学生信息
SELECT * FROM stu WHERE age >= 20;

-- 3. 查询年龄大于等于20岁，并且年龄小于等于30岁的学生信息
SELECT * FROM stu WHERE age >= 20 AND age <= 30;
SELECT * FROM stu WHERE age BETWEEN 20 AND 30;

-- 4. 查询出生日期在'2001-01-01'到'2005-10-01'之间的学生信息
SELECT * FROM stu WHERE birth_date BETWEEN '2001-01-01' AND '2005-10-01'

-- 5. 查询年龄等于18岁的学生信息
SELECT * FROM stu WHERE age = 18

-- 6. 查询年龄不等于18岁的学生信息
SELECT * FROM stu WHERE age <> 18

-- 7. 查询年龄等于18 或者年龄等于20岁 或者 年龄等于22岁的学生信息
SELECT * FROM stu WHERE age = 18 OR age = 20 OR age = 22

-- 8. 查询英语成绩位null的学生信息
SELECT * FROM stu WHERE english_score IS NULL

-- 9. 查询姓'马'的学生信息
SELECT * FROM stu WHERE `NAME` LIKE '马%'

-- 10. 查询第二个字是'花'的学生信息
SELECT * FROM stu WHERE `NAME` LIKE '_花%'

-- 11. 查询名字中包含 '德' 的学生信息
SELECT * FROM stu WHERE `NAME` LIKE '%德%'
```

#### 排序查询 (ORDER BY)

```sql
-- 1. 查询学生信息，按照年龄升序排序
SELECT * FROM stu ORDER BY age;

-- 2. 查询学生信息，按照年龄降序排序
SELECT * FROM stu ORDER BY age DESC;

-- 3. 查询学生信息，按照数学成绩降序排序，如果数学成绩一样，再按照英语成绩升序排序
SELECT * FROM stu ORDER BY math_score DESC, english_score
```

#### 分组查询 (GROUP BY)

**聚合函数**：将一列数据作为一个整体，进行纵向计算

- count: 统计数量，一般选用不为null的列
- max: 最大值
- min: 最小值
- sum: 求和
- avg: 平均值

**聚合函数语法**

```sql
SELECT 聚合函数名(列名) FROM 表;
```

注意：null值不参与所有聚合函数运算

```sql
-- 1. 统计班级一共有多少个学生
SELECT COUNT(id) FROM stu; -- count 统计的列不能为空
SELECT COUNT(*) FROM stu;

-- 2. 查询数学成绩的最高分
SELECT MAX(math_score) FROM stu;
-- 3. 查询数学成绩的最低分
SELECT MIN(math_score) FROM stu;
-- 4. 查询数学成绩的总分
SELECT SUM(math_score) FROM stu;
```

**分组查询**

**语法**

```sql
SELECT 字段列表 FROM 表名 [WHERE 分组前条件限定] GROUP BY 分组字段名 [HAVING 分组后条件过滤]
```

注意：分组之后，查询的字段为聚合函数和分组字段，查询其他字段无任何意义

where和having区别

- 执行时机不一样：where是分组之前进行限定，不满足where条件，则不参与分组，而having是分组之后对结果进行过滤；
- 可判断的条件不一样：where不能对聚合函数进行判断，having可以

执行顺序：where > 聚合函数 > having

```sql
-- 1. 查询男同学和女同学各自的数学平均分
SELECT gender, AVG(math_score) FROM stu GROUP BY gender;
-- 2. 查询男同学和女同学各自的数学平均分，以及各自人数
SELECT gender, AVG(math_score), COUNT(*) FROM stu GROUP BY gender;
-- 3. 查询男同学和女同学各自的数学平均分，以及各自人数，要求：分数低于70分的不参与分组
SELECT gender, AVG(math_score), COUNT(*) FROM stu WHERE math_score > 70 GROUP BY gender;
-- 4. 插叙男同学和女同学各自的数学平均分，以及各自人数，要求：分数低于70分的不参与分组，分组之后人数大于2人的
SELECT gender, AVG(math_score), COUNT(*) FROM stu WHERE math_score > 70 GROUP BY gender HAVING COUNT(*) > 2;
```

#### 分页查询 (LIMIT)

**语法**

```sql
SELECT 字段列表 FROM 表名 LIMIT 起始索引, 查询条数;
```

**起始索引**从0开始

**计算公式**：起始索引 = (当前页码 - 1)  * 每页显示条数

- 分页查询LIMIT是MySQL数据库的方言
- Oracle分页查询使用rownumber
- SQL Server分页查询使用 top

```sql
-- 1. 从0开始查询，查询3条数据
SELECT * FROM stu LIMIT 0, 3;
-- 2. 每页显示3条数据，查询第1页数据
SELECT * FROM stu LIMIT 0, 3;
-- 3. 每页显示3条数据，查询第2页数据
SELECT * FROM stu LIMIT 3, 3;
-- 4. 每页显示3条数据，查询第3页数据
SELECT * FROM stu LIMIT 6, 3;
```


























































